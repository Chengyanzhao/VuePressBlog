<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise | Cheng</title>
    <meta name="description" content="Just some codes.">
    <link rel="icon" href="/VuePressBlog/logo.png">
  <link rel="bookmark" href="/VuePressBlog/logo.ico">
    
    <link rel="preload" href="/VuePressBlog/assets/css/0.styles.d664a5b7.css" as="style"><link rel="preload" href="/VuePressBlog/assets/js/app.6f7b1c6f.js" as="script"><link rel="preload" href="/VuePressBlog/assets/js/30.99e02afd.js" as="script"><link rel="prefetch" href="/VuePressBlog/assets/js/29.3d695fa6.js"><link rel="prefetch" href="/VuePressBlog/assets/js/2.358e4e33.js"><link rel="prefetch" href="/VuePressBlog/assets/js/3.b024281b.js"><link rel="prefetch" href="/VuePressBlog/assets/js/4.1bf58f9b.js"><link rel="prefetch" href="/VuePressBlog/assets/js/5.6c63c20b.js"><link rel="prefetch" href="/VuePressBlog/assets/js/6.cc55cc55.js"><link rel="prefetch" href="/VuePressBlog/assets/js/7.ec0dde70.js"><link rel="prefetch" href="/VuePressBlog/assets/js/8.2ad5b20e.js"><link rel="prefetch" href="/VuePressBlog/assets/js/9.933c9b3e.js"><link rel="prefetch" href="/VuePressBlog/assets/js/10.46cee26d.js"><link rel="prefetch" href="/VuePressBlog/assets/js/11.895738dd.js"><link rel="prefetch" href="/VuePressBlog/assets/js/12.3572c736.js"><link rel="prefetch" href="/VuePressBlog/assets/js/13.af0c5e33.js"><link rel="prefetch" href="/VuePressBlog/assets/js/14.c7d21f55.js"><link rel="prefetch" href="/VuePressBlog/assets/js/15.ae0dcb1e.js"><link rel="prefetch" href="/VuePressBlog/assets/js/16.09e03e56.js"><link rel="prefetch" href="/VuePressBlog/assets/js/17.d135e43f.js"><link rel="prefetch" href="/VuePressBlog/assets/js/18.55b86b08.js"><link rel="prefetch" href="/VuePressBlog/assets/js/19.1c2ce6b0.js"><link rel="prefetch" href="/VuePressBlog/assets/js/20.4e2db883.js"><link rel="prefetch" href="/VuePressBlog/assets/js/21.20cecde8.js"><link rel="prefetch" href="/VuePressBlog/assets/js/22.e9cb2c3d.js"><link rel="prefetch" href="/VuePressBlog/assets/js/23.ea36a281.js"><link rel="prefetch" href="/VuePressBlog/assets/js/24.6ddf60f2.js"><link rel="prefetch" href="/VuePressBlog/assets/js/25.3a90fcf1.js"><link rel="prefetch" href="/VuePressBlog/assets/js/26.5f58a8f8.js"><link rel="prefetch" href="/VuePressBlog/assets/js/27.db04cd9a.js"><link rel="prefetch" href="/VuePressBlog/assets/js/28.1205efc8.js"><link rel="prefetch" href="/VuePressBlog/assets/js/31.98ffbf3e.js"><link rel="prefetch" href="/VuePressBlog/assets/js/32.1f7bf38b.js"><link rel="prefetch" href="/VuePressBlog/assets/js/33.efff21a6.js"><link rel="prefetch" href="/VuePressBlog/assets/js/34.c5f76730.js"><link rel="prefetch" href="/VuePressBlog/assets/js/35.1c4f0801.js"><link rel="prefetch" href="/VuePressBlog/assets/js/36.7712d0cb.js"><link rel="prefetch" href="/VuePressBlog/assets/js/37.95666830.js"><link rel="prefetch" href="/VuePressBlog/assets/js/38.a8640969.js"><link rel="prefetch" href="/VuePressBlog/assets/js/39.5377118a.js"><link rel="prefetch" href="/VuePressBlog/assets/js/40.a61488fd.js"><link rel="prefetch" href="/VuePressBlog/assets/js/41.643d1566.js"><link rel="prefetch" href="/VuePressBlog/assets/js/42.5fcb8f85.js"><link rel="prefetch" href="/VuePressBlog/assets/js/43.459d6044.js"><link rel="prefetch" href="/VuePressBlog/assets/js/44.ad8bab6f.js"><link rel="prefetch" href="/VuePressBlog/assets/js/45.97c25cff.js"><link rel="prefetch" href="/VuePressBlog/assets/js/46.f88e3c41.js"><link rel="prefetch" href="/VuePressBlog/assets/js/47.b6b64942.js"><link rel="prefetch" href="/VuePressBlog/assets/js/48.d222752a.js"><link rel="prefetch" href="/VuePressBlog/assets/js/49.e496552d.js"><link rel="prefetch" href="/VuePressBlog/assets/js/50.63b3f880.js"><link rel="prefetch" href="/VuePressBlog/assets/js/51.e8d30f24.js"><link rel="prefetch" href="/VuePressBlog/assets/js/52.4d9effb7.js"><link rel="prefetch" href="/VuePressBlog/assets/js/53.d79f3dfd.js"><link rel="prefetch" href="/VuePressBlog/assets/js/54.c4bae3dc.js"><link rel="prefetch" href="/VuePressBlog/assets/js/55.f2f40db4.js"><link rel="prefetch" href="/VuePressBlog/assets/js/56.24aa0083.js"><link rel="prefetch" href="/VuePressBlog/assets/js/57.c933a44b.js"><link rel="prefetch" href="/VuePressBlog/assets/js/58.12b9a96e.js"><link rel="prefetch" href="/VuePressBlog/assets/js/59.ce8b4d63.js"><link rel="prefetch" href="/VuePressBlog/assets/js/60.c55cff7b.js"><link rel="prefetch" href="/VuePressBlog/assets/js/61.ac5a7571.js"><link rel="prefetch" href="/VuePressBlog/assets/js/62.bb33c6c1.js">
    <link rel="stylesheet" href="/VuePressBlog/assets/css/0.styles.d664a5b7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/VuePressBlog/" class="home-link router-link-active"><!----> <span class="site-name">Cheng</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/VuePressBlog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/HTML/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/JavaScript/" class="nav-link router-link-active">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/DOM/" class="nav-link">DOM</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/FE/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Deploy/" class="nav-link">部署</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Regexp/" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Compatibility/" class="nav-link">兼容性</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/System/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePressBlog/column/juniorclass/" class="nav-link">前端入门</a></li></ul></div></div><div class="nav-item"><a href="/VuePressBlog/paino/" class="nav-link">钢琴</a></div><div class="nav-item"><a href="/VuePressBlog/chitchat/" class="nav-link">闲扯</a></div><div class="nav-item"><a href="/VuePressBlog/about/" class="nav-link">关于</a></div> <a href="https://github.com/Chengyanzhao/VuePressBlog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/VuePressBlog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/HTML/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/JavaScript/" class="nav-link router-link-active">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/DOM/" class="nav-link">DOM</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/FE/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Deploy/" class="nav-link">部署</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Regexp/" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Compatibility/" class="nav-link">兼容性</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/System/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/VuePressBlog/blog/Other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePressBlog/column/juniorclass/" class="nav-link">前端入门</a></li></ul></div></div><div class="nav-item"><a href="/VuePressBlog/paino/" class="nav-link">钢琴</a></div><div class="nav-item"><a href="/VuePressBlog/chitchat/" class="nav-link">闲扯</a></div><div class="nav-item"><a href="/VuePressBlog/about/" class="nav-link">关于</a></div> <a href="https://github.com/Chengyanzhao/VuePressBlog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>JavaScript</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/VuePressBlog/blog/JavaScript/" class="sidebar-link">JavaScript</a></li><li><a href="/VuePressBlog/blog/JavaScript/jsonp.html" class="sidebar-link">jsonp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/jsonp.html#关键点" class="sidebar-link">关键点</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/jsonp.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/jsonp.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/VuePressBlog/blog/JavaScript/hoisting.html" class="sidebar-link">javascript的变量提升</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/hoisting.html#变量提升过程" class="sidebar-link">变量提升过程</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/hoisting.html#为什么要进行变量提升" class="sidebar-link">为什么要进行变量提升</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/hoisting.html#变量提升规则" class="sidebar-link">变量提升规则</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/hoisting.html#mdn" class="sidebar-link">MDN</a></li></ul></li><li><a href="/VuePressBlog/blog/JavaScript/modules.html" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/modules.html#模块化" class="sidebar-link">模块化</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/modules.html#常用规范" class="sidebar-link">常用规范</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/modules.html#exports-module-exports-export-export-default的区别" class="sidebar-link">exports, module.exports, export, export default的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/modules.html#commonjs模块规范" class="sidebar-link">CommonJS模块规范</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/modules.html#es6模块规范" class="sidebar-link">ES6模块规范</a></li></ul></li></ul></li><li><a href="/VuePressBlog/blog/JavaScript/array-unique.html" class="sidebar-link">浅谈数组去重</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/array-unique.html#indexof" class="sidebar-link">indexOf</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/array-unique.html#includes" class="sidebar-link">includes</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/array-unique.html#key唯一" class="sidebar-link">key唯一</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/array-unique.html#es6-set" class="sidebar-link">ES6 Set</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/array-unique.html#es6-map" class="sidebar-link">ES6 Map</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/array-unique.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/array-unique.html#todo" class="sidebar-link">TODO</a></li></ul></li><li><a href="/VuePressBlog/blog/JavaScript/promise.html" class="active sidebar-link">Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#关于promise-promise-promises" class="sidebar-link">关于Promise,promise,promises</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#api" class="sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-constructor" class="sidebar-link">Promise constructor</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-all" class="sidebar-link">Promise.all</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-prototype-catch" class="sidebar-link">Promise.prototype.catch()</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-prototype-finally" class="sidebar-link">Promise.prototype.finally()</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-prototype-then" class="sidebar-link">Promise.prototype.then()</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-race" class="sidebar-link">Promise.race()</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-reject" class="sidebar-link">Promise.reject()</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#promise-resolve" class="sidebar-link">Promise.resolve()</a></li></ul></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#应用" class="sidebar-link">应用</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#es5实现" class="sidebar-link">ES5实现</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#try-catch与promise" class="sidebar-link">try/catch与Promise</a></li><li class="sidebar-sub-header"><a href="/VuePressBlog/blog/JavaScript/promise.html#reference" class="sidebar-link">Reference</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="promise"><a href="#promise" aria-hidden="true" class="header-anchor">#</a> Promise</h1> <p>Promise是异步变成的解决方案，旨在解决异步编程回调地狱的问题。<br>
Promise最早由社区最早提出和实现，ES6将其写进了语言标准，统一了用法，原生提供了<code>Promise</code>对象。在ES5中也有<code>polyfill</code>对其支持，所以不使用ES6的伙计也不用担心因浏览器兼容性而无法使用Promise。</p> <h2 id="关于promise-promise-promises"><a href="#关于promise-promise-promises" aria-hidden="true" class="header-anchor">#</a> 关于Promise,promise,promises</h2> <ul><li>Promise: 代表Promise接口</li> <li>promise: 代表promise实例对象</li> <li>promises: 代表Promises规范</li></ul> <h2 id="简介"><a href="#简介" aria-hidden="true" class="header-anchor">#</a> 简介</h2> <p>Promise因异步而生，所以介绍Promise就以异步操作为入口。<br>
在Promise出现之前，如果我们需要依赖一个异步操作的结果进行下一个异步操作，比如嵌套的<code>ajax</code>请求，代码会写成这样：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 执行第一个异步请求</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// options</span>
  success<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data1<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 获取结果，执行第二个异步请求</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// options</span>
      data<span class="token punctuation">:</span>data1<span class="token punctuation">,</span>
      success<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// do something</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>由于第二个请求的参数需要依赖第一个请求的结果，所以需要等到第一个请求返回结果时，才能在第一个请求的回调中构造第二个请求。
这样两个请求的代码就形成了嵌套。<br>
如果有n个这种依赖的请求，就需要嵌套n层代码，这样的代码乱成一团，不易维护。
这里有同学会提出，那我用同步请求如何？同步请求会阻塞代码执行，如果涉及到页面渲染，用户很有可能需要等到执行完成才能操作页面，极大的降低了用户体验，很可能与需求不符合，所非特殊情况不建议使用同步请求。</p> <p>改用Promise：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// options</span>
    success<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data1<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data1<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data1<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// options</span>
    data<span class="token punctuation">:</span>data1<span class="token punctuation">,</span>
    success<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>使用Promise后我们把每个回调都拆分开，使用<code>then</code>将他们连接起来，代码逻辑更清晰。</p> <h2 id="api"><a href="#api" aria-hidden="true" class="header-anchor">#</a> API</h2> <h3 id="promise-constructor"><a href="#promise-constructor" aria-hidden="true" class="header-anchor">#</a> Promise constructor</h3> <p>Promise构造函数接收两个参数，<code>resolve</code>和<code>reject</code>。<br> <code>resolve</code>对应异步操作完成的函数，<code>reject</code>对应异步操作失败的函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> syncSuccess <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>syncSuccess<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'错误'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// do something success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// do something error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="promise-all"><a href="#promise-all" aria-hidden="true" class="header-anchor">#</a> Promise.all</h3> <h3 id="promise-prototype-catch"><a href="#promise-prototype-catch" aria-hidden="true" class="header-anchor">#</a> Promise.prototype.catch()</h3> <h3 id="promise-prototype-finally"><a href="#promise-prototype-finally" aria-hidden="true" class="header-anchor">#</a> Promise.prototype.finally()</h3> <h3 id="promise-prototype-then"><a href="#promise-prototype-then" aria-hidden="true" class="header-anchor">#</a> Promise.prototype.then()</h3> <h3 id="promise-race"><a href="#promise-race" aria-hidden="true" class="header-anchor">#</a> Promise.race()</h3> <h3 id="promise-reject"><a href="#promise-reject" aria-hidden="true" class="header-anchor">#</a> Promise.reject()</h3> <h3 id="promise-resolve"><a href="#promise-resolve" aria-hidden="true" class="header-anchor">#</a> Promise.resolve()</h3> <h2 id="应用"><a href="#应用" aria-hidden="true" class="header-anchor">#</a> 应用</h2> <h2 id="es5实现"><a href="#es5实现" aria-hidden="true" class="header-anchor">#</a> ES5实现</h2> <h2 id="try-catch与promise"><a href="#try-catch与promise" aria-hidden="true" class="header-anchor">#</a> try/catch与Promise</h2> <p>在使用Promise与try/catch时请慎重。<br>
在阮老师的文章里有这么一段话：</p> <blockquote><p>跟传统的try/catch代码块不同的是，如果没有使用catch方法指定错误处理的回调函数，Promise 对象抛出的错误不会传递到外层代码，即不会有任何反应。</p></blockquote> <p>如果在promise中抛出异常，异常是不会像外层代码传递的，只会向promise后的catch传递。看下面代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
  Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'错误'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果你在浏览器中运行这段代码，浏览器会报错<code>Uncaught (in promise) 错误</code>。<br>
疑问来了，为什么我已经将<code>reject</code>放在<code>try</code>块中，而捕捉不到？<br>
实际上<strong>拒绝是发生在未来</strong>，而不是执行<code>Promise.reject('错误')</code>时。所以当这行代码执行完毕，<code>try</code>块内的代码已正常执行完成，所以不会进入<code>catch</code>。</p> <p>将代码改成下面这样可能会更好理解一些：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
  Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'错误'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以在使用Promise时请慎重，不要试图使用<code>try/catch</code>去捕捉<code>reject</code>。</p> <h2 id="reference"><a href="#reference" aria-hidden="true" class="header-anchor">#</a> Reference</h2> <ol><li><a href="http://es6.ruanyifeng.com/#docs/promise#Promise-%E7%9A%84%E5%90%AB%E4%B9%89" target="_blank" rel="noopener noreferrer">ECMAScript 6 入门 - Promise 对象 - 阮一峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">MDN - Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/VuePressBlog/blog/JavaScript/array-unique.html" class="prev">
          浅谈数组去重
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/VuePressBlog/assets/js/30.99e02afd.js" defer></script><script src="/VuePressBlog/assets/js/app.6f7b1c6f.js" defer></script>
  </body>
</html>
